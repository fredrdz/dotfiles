#------------------------------- General Settings -------------------------------
# Default Shell
set -g default-shell /bin/zsh

#REF1: https://medium.com/@dubistkomisch/how-to-actually-get-italics-and-true-colour-to-work-in-iterm-tmux-vim-9ebe55ebc2be/
#REF2: https://jdhao.github.io/2018/10/19/tmux_nvim_true_color/
#REF3: https://herrbischoff.com/2020/08/how-to-enable-italics-in-tmux/
# True Color Support
set -g default-terminal 'tmux-256color'
set -as terminal-overrides ',xterm*:Tc:sitm=\E[3m'

# By default tmux windows and panes start with number 0. We could start numbering with 1.
set -g base-index 1
set -g pane-base-index 1

# Set the escape time to 0 for faster key repetition.
# Tmux generally waits for a certain time after an escape is input to determine if it is a part of a function or meta key sequences.
# The default is 500 milliseconds.
set -s escape-time 0

# Allow the arrow key to be used immediately after changing windows.
set-option -g repeat-time 0

# Enable Clipboard
set -g set-clipboard on

# Mouse Support
set -g mouse on

# By default tmux uses ctrl-b (C-b) as the prefix key.
# Changed to:
set-option -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix

# Vim-styled pane movement.
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Window resizing.
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r K resize-pane -U 5
bind -r J resize-pane -D 5

# Hot-reloading tmux config.
# Uses prefix + r to reload.
bind r source-file ~/.tmux.conf \; display "Reloaded .tmux.conf"

# Increase duration of pane numbers display
set -g display-panes-time 3000

# Vim-styled buffer movement.
# Enable vi keys.
setw -g mode-keys vi

# Escape turns on copy mode.
bind Escape copy-mode

# Visually select and yank to system clipboard.
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -sel clip -i'
# like visual block mode
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# Make Prefix p paste the buffer.
unbind p
bind p paste-buffer

# Keeps current path for new windows and panes.
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Smart pane switching with awareness of Vim splits and fzf windows.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

# See: https://github.com/keeganlow/dotfiles/blob/master/.tmux.conf
is_fzf="ps -o state= -o comm= -t '#{pane_tty}' \
  | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?fzf$'"

bind-key -n 'C-k' if-shell "($is_vim || $is_fzf)" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-j' if-shell "($is_vim || $is_fzf)" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# go to last pane (like b# in vim)
bind '#' select-pane -l

# Focus events enabled for terminals that support them.
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup.
setw -g aggressive-resize on

#------------------------------- Status Bar Settings -------------------------------
set-option -g status on
set-option -g status-position top # [top, bottom]
set-option -g status-interval 2
set-option -g status-justify "centre"
set-option -g status-left-length 150
set-option -g status-right-length 150
set-option -g status-left "#(~/git/tmux-powerline/powerline.sh left)"
set-option -g status-right "#(~/git/tmux-powerline/powerline.sh right)"
set-hook -g session-created 'run-shell "~/git/tmux-powerline/powerline.sh init"' # prettifies the window-status segments

#------------------------------- Pane Colors -------------------------------
#set inactive/active window styles
set -g window-style 'fg=#444444,bg=#171717'
set -g window-active-style 'fg=#DCD7BA,bg=#1F1F28'

# set the pane border colors
set -g pane-border-style 'fg=#444444,bg=#171717'
set -g pane-active-border-style 'fg=#00ADB5,bg=#1F1F28'

#------------------------------- MISC -------------------------------
# Mac Os Command+K (Clear scrollback buffer)
bind -n C-k clear-history

# Set a larger scroll back
set-option -g history-limit 10000

# A quiter setup
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

#------------------------------- TMUX PLUGINS -------------------------------
# https://github.com/tmux-plugins/tpm
# installs plugin: prefix + I
# updates: prefix + U
# uninstalls: prefix + alt + u

# plugin list
set -g @plugin 'tmux-plugins/tmux-resurrect'
# for tmux-resurrect
# save session: prefix + s
# restore: prefix + r

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
